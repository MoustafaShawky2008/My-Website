<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ambulance Route Master — نظام إدارة مسارات الإسعاف</title>
  <meta name="description" content="نظام عرض المسارات مع واجهة عربية وانجليزية" />
  <style>
    :root{
      --bg1:#071429; --bg2:#0d3b66; --accent:#0d6efd; --glass: rgba(255,255,255,0.06);
      --card:#ffffff; --muted:#6b7280; --success:#27ae60; --danger:#e74c3c; --glass-2: rgba(255,255,255,0.04);
      --text-primary: #ffffff; --text-secondary: #cfe8ff;
    }
    /* Animated gradient background that slowly shifts colors */
    body{
      margin:0; font-family: 'Segoe UI', Tahoma, Arial, sans-serif; -webkit-font-smoothing:antialiased; background: linear-gradient(135deg,var(--bg1),var(--bg2)); min-height:100vh; color:var(--text-primary);
      transition: background 1s ease; font-size: 16px; line-height: 1.6;
    }
    .animated-bg{ position:fixed; inset:0; z-index:-1; background: linear-gradient(0deg, rgba(13,59,102,0.15), rgba(7,20,41,0.15)); background-size:400% 400%; animation: gradientShift 18s ease infinite; }
    @keyframes gradientShift{ 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

    /* Login Screen */
    .login-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0d3b66, #071429);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 0.5s ease;
    }
    
    .login-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }
    
    .login-logo {
      font-size: 48px;
      color: var(--accent);
      margin-bottom: 20px;
    }
    
    .login-title {
      font-size: 28px;
      margin-bottom: 30px;
      font-weight: 700;
      color: white;
    }
    
    .login-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .form-group {
      text-align: right;
    }
    
    .form-group.en {
      text-align: left;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
      font-weight: 600;
    }
    
    .form-input {
      width: 100%;
      padding: 14px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.08);
      color: white;
      font-size: 16px;
      transition: all 0.3s ease;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.2);
    }
    
    .login-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 16px;
      border-radius: 10px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }
    
    .login-btn:hover {
      background: #0b5ed7;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(13, 110, 253, 0.4);
    }

    /* Main App */
    .app-container {
      display: none;
    }

    /* container */
    .container{ max-width:1400px; margin:24px auto; padding:0 20px; }

    header{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:18px; }
    .brand{ display:flex; gap:12px; align-items:center; color:var(--text-primary) }
    .brand i{ font-size:32px }
    .brand h1{ font-size:24px; font-weight:700; margin:0 }

    .top-actions{ display:flex; gap:10px; align-items:center }
    .lang-switch{ background:transparent; border:1px solid rgba(255,255,255,0.12); color:var(--text-primary); padding:10px 14px; border-radius:8px; cursor:pointer; font-size: 16px; }
    .theme-toggle{ background:rgba(255,255,255,0.06); color:var(--text-primary); border-radius:8px; padding:10px 14px; cursor:pointer; border:none; font-size: 16px; }
    .user-menu{ display:flex; align-items:center; gap:10px; color:var(--text-primary); }
    .user-avatar{ width:40px; height:40px; border-radius:50%; background:var(--accent); display:flex; align-items:center; justify-content:center; font-weight:bold; }

    /* layout */
    .dashboard{ display:grid; grid-template-columns:380px 1fr; gap:20px; }

    /* sidebar / control-panel */
    .control-panel{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:20px; color:var(--text-primary); box-shadow:0 8px 30px rgba(2,6,23,0.5); position:relative; overflow:hidden; border: 1px solid rgba(255,255,255,0.05); }

    label{ display:block; margin-bottom:8px; color:var(--text-secondary); font-weight:600; font-size: 16px; }
    input[type=text], select{ width:100%; padding:12px 14px; border-radius:8px; border:1px solid rgba(255,255,255,0.08); background:rgba(255,255,255,0.05); color:var(--text-primary); font-size: 16px; }
    input[type=text]::placeholder{ color: rgba(255,255,255,0.5); }
    .btn{ display:inline-block; background:var(--accent); color:var(--text-primary); border:none; padding:12px 16px; border-radius:10px; width:100%; cursor:pointer; font-weight:700; font-size: 16px; transition: all 0.3s ease; }
    .btn:hover{ background:#0b5ed7; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3); }
    .btn-secondary{ background:rgba(255,255,255,0.1); }
    .btn-secondary:hover{ background:rgba(255,255,255,0.15); }

    .route-info{ background:rgba(255,255,255,0.03); padding:16px; border-radius:10px; margin-top:16px; border: 1px solid rgba(255,255,255,0.05); }
    .info-item{ display:flex; justify-content:space-between; margin-bottom:10px; font-size: 16px; }

    .routes-list{ margin-top:16px; max-height:240px; overflow:auto; }
    .route-option{ background:rgba(255,255,255,0.03); padding:12px; border-radius:8px; margin-bottom:10px; cursor:pointer; border:1px solid rgba(255,255,255,0.05); transition: all 0.3s ease; }
    .route-option:hover{ background:rgba(255,255,255,0.06); }
    .route-option.active{ outline:2px solid var(--accent); box-shadow:0 6px 18px rgba(13,110,253,0.15); background:rgba(13,110,253,0.1); }

    .map-panel{ border-radius:14px; overflow:hidden; position:relative; min-height:640px; box-shadow:0 8px 30px rgba(2,6,23,0.45); border: 1px solid rgba(255,255,255,0.05); }
    #map{ width:100%; height:100%; min-height:580px }

    .status-bar{ position:absolute; bottom:12px; left:12px; right:12px; display:flex; justify-content:space-between; gap:12px; background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03)); padding:12px 16px; border-radius:10px; align-items:center; border: 1px solid rgba(255,255,255,0.05); }
    .status-item{ display:flex; gap:8px; align-items:center; color:var(--text-primary); font-size: 15px; }

    /* about modal */
    .modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(2,6,23,0.7); visibility:hidden; opacity:0; transition:opacity .2s ease, visibility .2s; z-index: 1000; }
    .modal.show{ visibility:visible; opacity:1 }
    .modal-card{ width:900px; max-width:94%; background:linear-gradient(135deg, #0f1c30, #152642); color:var(--text-primary); border-radius:14px; padding:24px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
    .modal-grid{ display:grid; grid-template-columns:1fr 240px; gap:16px; }
    .close-btn{ background:var(--accent); color:var(--text-primary); padding:8px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:600; transition: all 0.3s ease; }
    .close-btn:hover{ background:#0b5ed7; }

    footer{ color:var(--text-secondary); margin-top:20px; text-align:center; font-size: 14px; }

    /* responsive */
    @media(max-width:1024px){ .dashboard{ grid-template-columns:1fr; } }

    /* small helpers */
    .muted{ color:rgba(255,255,255,0.6) }
    .kbd{ background:rgba(255,255,255,0.05); padding:6px 10px; border-radius:6px; color:var(--text-primary); font-weight:700; font-size: 14px; }
    
    /* Settings panel */
    .settings-panel{ margin-top: 20px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.05); }
    .settings-grid{ display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
    .setting-item{ background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; }
    .setting-title{ font-weight: 600; margin-bottom: 8px; color: var(--text-secondary); }
    
    /* Traffic indicators */
    .traffic-indicators{ display: flex; gap: 10px; margin-top: 16px; }
    .traffic-indicator{ flex: 1; text-align: center; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.03); }
    .indicator-value{ font-size: 18px; font-weight: 700; margin: 5px 0; }
    
    /* Signal controls */
    .signal-controls{ display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
    .signal-btn{ background: rgba(255,255,255,0.05); color: var(--text-primary); border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.3s ease; }
    .signal-btn:hover{ background: rgba(255,255,255,0.1); }
    .signal-btn.active{ background: var(--accent); border-color: var(--accent); }
    
    /* Emergency panel */
    .emergency-panel{ background: rgba(220, 53, 69, 0.1); border: 1px solid rgba(220, 53, 69, 0.3); border-radius: 10px; padding: 16px; margin-top: 20px; }
    .emergency-title{ color: #dc3545; font-weight: 700; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
    
    /* Tabs */
    .tabs{ display: flex; gap: 8px; margin-bottom: 16px; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .tab{ padding: 10px 16px; cursor: pointer; border-radius: 8px 8px 0 0; transition: all 0.3s ease; }
    .tab.active{ background: rgba(255,255,255,0.05); color: var(--accent); }
    
    /* Progress bars */
    .progress{ height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; margin-top: 8px; }
    .progress-bar{ height: 100%; background: var(--accent); border-radius: 4px; }
    
    /* RTL/LTR support */
    body[dir="rtl"] .control-panel {
      order: 1;
    }
    
    body[dir="rtl"] .map-panel {
      order: 2;
    }
    
    body[dir="ltr"] .control-panel {
      order: 2;
    }
    
    body[dir="ltr"] .map-panel {
      order: 1;
    }
    
    body[dir="ltr"] {
      direction: ltr;
    }
    
    body[dir="ltr"] .form-group {
      text-align: left;
    }
    
    body[dir="ltr"] .info-item {
      flex-direction: row;
    }
    
    body[dir="ltr"] .status-bar {
      flex-direction: row;
    }
    
    body[dir="ltr"] .tabs {
      flex-direction: row;
    }
    
    body[dir="ltr"] .signal-controls {
      grid-template-columns: 1fr 1fr;
    }
    
    body[dir="ltr"] .settings-grid {
      grid-template-columns: 1fr 1fr;
    }
    
    body[dir="ltr"] .traffic-indicators {
      flex-direction: row;
    }
    
    body[dir="ltr"] .modal-grid {
      grid-template-columns: 1fr 240px;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body dir="rtl">
  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <div class="login-container">
      <div class="login-logo">
        <i class="fas fa-ambulance"></i>
      </div>
      <h1 class="login-title" data-lang="ar">نظام مسارات الإسعاف</h1>
      <h1 class="login-title" data-lang="en" style="display:none">Ambulance Route System</h1>
      
      <div class="login-form">
        <div class="form-group">
          <label class="form-label" data-lang="ar">اسم السائق</label>
          <label class="form-label" data-lang="en" style="display:none">Driver Name</label>
          <input type="text" class="form-input" id="driverName" placeholder="أدخل اسم السائق" data-lang="ar">
          <input type="text" class="form-input" id="driverNameEn" placeholder="Enter driver name" data-lang="en" style="display:none">
        </div>
        
        <div class="form-group">
          <label class="form-label" data-lang="ar">رقم سيارة الإسعاف</label>
          <label class="form-label" data-lang="en" style="display:none">Ambulance Number</label>
          <input type="text" class="form-input" id="ambulanceNumber" placeholder="أدخل رقم السيارة" data-lang="ar">
          <input type="text" class="form-input" id="ambulanceNumberEn" placeholder="Enter ambulance number" data-lang="en" style="display:none">
        </div>
        
        <button class="login-btn" id="loginBtn">
          <span data-lang="ar">بدء النظام</span>
          <span data-lang="en" style="display:none">Start System</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Application -->
  <div class="app-container" id="appContainer">
    <div class="animated-bg"></div>
    <div class="container">
      <header>
        <div class="brand">
          <i class="fas fa-ambulance" style="color:var(--accent)"></i>
          <div>
            <h1 data-lang="ar">نظام مسارات الإسعاف المتقدم</h1>
            <h1 data-lang="en" style="display:none">Advanced Ambulance Route System</h1>
            <div style="font-size: 14px; color: var(--text-secondary); margin-top: 4px;">
              <span id="driverDisplay" data-lang="ar">السائق: -</span>
              <span id="ambulanceDisplay" data-lang="ar"> | رقم السيارة: -</span>
              <span id="driverDisplayEn" data-lang="en" style="display:none">Driver: -</span>
              <span id="ambulanceDisplayEn" data-lang="en" style="display:none"> | Ambulance: -</span>
            </div>
          </div>
        </div>
        <div class="top-actions">
          <div class="user-menu">
            <div class="user-avatar" id="userAvatar">م</div>
            <span id="userName" data-lang="ar">مشرف النظام</span>
            <span id="userNameEn" data-lang="en" style="display:none">System Admin</span>
          </div>
          <button class="lang-switch" id="langToggle">
            <span data-lang="ar">English</span>
            <span data-lang="en" style="display:none">العربية</span>
          </button>
          <button class="theme-toggle" id="themeBtn">
            <i class="fas fa-palette"></i>
          </button>
          <button class="btn" id="aboutBtn" style="padding:10px 14px; width: auto;">
            <span data-lang="ar">عن النظام</span>
            <span data-lang="en" style="display:none">About</span>
          </button>
        </div>
      </header>

      <div class="dashboard">
        <aside class="control-panel">
          <div class="tabs">
            <div class="tab active" data-tab="routing">
              <span data-lang="ar">التوجيه</span>
              <span data-lang="en" style="display:none">Routing</span>
            </div>
            <div class="tab" data-tab="settings">
              <span data-lang="ar">الإعدادات</span>
              <span data-lang="en" style="display:none">Settings</span>
            </div>
            <div class="tab" data-tab="monitoring">
              <span data-lang="ar">المراقبة</span>
              <span data-lang="en" style="display:none">Monitoring</span>
            </div>
          </div>

          <div class="tab-content" id="routing-tab">
            <h2 class="panel-title" style="color:var(--accent); margin-bottom: 16px;"><i class="fas fa-route"></i> <span data-lang="ar">تخطيط المسار</span><span data-lang="en" style="display:none">Route Planning</span></h2>

            <div style="margin-top:10px">
              <label for="destination">
                <i class="fas fa-map-marker-alt"></i> 
                <span data-lang="ar">الوجهة</span>
                <span data-lang="en" style="display:none">Destination</span>
              </label>
              <input id="destination" type="text" placeholder="أدخل عنوان الوجهة" data-lang="ar" />
              <input id="destinationEn" type="text" placeholder="Enter destination address" data-lang="en" style="display:none" />
            </div>

            <div style="margin-top:16px">
              <label for="route-preference">
                <i class="fas fa-sliders-h"></i>
                <span data-lang="ar">تفضيل المسار</span>
                <span data-lang="en" style="display:none">Route Preference</span>
              </label>
              <select id="route-preference">
                <option value="best" data-lang="ar">أفضل مسار (مستحكم)</option>
                <option value="best" data-lang="en" style="display:none">Best Route (AI)</option>
                <option value="fastest" data-lang="ar">أسرع مسار</option>
                <option value="fastest" data-lang="en" style="display:none">Fastest Route</option>
                <option value="shortest" data-lang="ar">أقصر مسار</option>
                <option value="shortest" data-lang="en" style="display:none">Shortest Route</option>
                <option value="avoid-traffic" data-lang="ar">تجنب الازدحام</option>
                <option value="avoid-traffic" data-lang="en" style="display:none">Avoid Traffic</option>
                <option value="green-corridor" data-lang="ar">الممر الأخضر</option>
                <option value="green-corridor" data-lang="en" style="display:none">Green Corridor</option>
              </select>
            </div>

            <div style="margin-top:16px">
              <button id="calculate-route" class="btn">
                <i class="fas fa-directions"></i> 
                <span data-lang="ar">احسب المسار</span>
                <span data-lang="en" style="display:none">Calculate Route</span>
              </button>
            </div>

            <div class="route-info">
              <h3 style="margin-bottom: 12px;">
                <i class="fas fa-info-circle"></i> 
                <span data-lang="ar">معلومات المسار</span>
                <span data-lang="en" style="display:none">Route Information</span>
              </h3>
              <div class="info-item">
                <span data-lang="ar">المسافة:</span>
                <span data-lang="en" style="display:none">Distance:</span>
                <span id="distance">--</span>
              </div>
              <div class="info-item">
                <span data-lang="ar">الوقت المتوقع:</span>
                <span data-lang="en" style="display:none">ETA:</span>
                <span id="duration">--</span>
              </div>
              <div class="info-item">
                <span data-lang="ar">حالة المرور:</span>
                <span data-lang="en" style="display:none">Traffic:</span>
                <span id="traffic">--</span>
              </div>
              <div class="traffic-status" style="margin-top:12px; display:flex; gap:10px; align-items:center">
                <div class="traffic-light" id="traffic-indicator" style="width:16px; height:16px; border-radius:50%; background:#27ae60"></div>
                <span id="traffic-text" data-lang="ar">جارٍ تحليل حركة المرور...</span>
                <span id="traffic-text-en" data-lang="en" style="display:none">Analyzing traffic...</span>
              </div>
            </div>

            <div class="routes-list" id="routes-list">
              <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                <i class="fas fa-route" style="font-size: 24px; margin-bottom: 8px;"></i>
                <div data-lang="ar">سيظهر هنا قائمة المسارات المتاحة</div>
                <div data-lang="en" style="display:none">Available routes will appear here</div>
              </div>
            </div>

            <div class="signal-controls">
              <button class="signal-btn" id="green-corridor">
                <i class="fas fa-traffic-light"></i>
                <div data-lang="ar">الممر الأخضر</div>
                <div data-lang="en" style="display:none">Green Corridor</div>
              </button>
              <button class="signal-btn" id="clear-right">
                <i class="fas fa-arrow-right"></i>
                <div data-lang="ar">إخلاء اليمين</div>
                <div data-lang="en" style="display:none">Clear Right</div>
              </button>
            </div>
          </div>

          <div class="tab-content" id="settings-tab" style="display: none;">
            <h2 class="panel-title" style="color:var(--accent); margin-bottom: 16px;">
              <i class="fas fa-cog"></i> 
              <span data-lang="ar">إعدادات النظام</span>
              <span data-lang="en" style="display:none">System Settings</span>
            </h2>
            
            <div class="settings-grid">
              <div class="setting-item">
                <div class="setting-title" data-lang="ar">إعدادات الخريطة</div>
                <div class="setting-title" data-lang="en" style="display:none">Map Settings</div>
                <div style="margin-top: 8px;">
                  <input type="checkbox" id="traffic-layer" checked>
                  <label for="traffic-layer" style="display: inline; margin-left: 8px;" data-lang="ar">طبقة حركة المرور</label>
                  <label for="traffic-layer" style="display: inline; margin-left: 8px; display: none;" data-lang="en">Traffic Layer</label>
                </div>
                <div style="margin-top: 8px;">
                  <input type="checkbox" id="satellite-view">
                  <label for="satellite-view" style="display: inline; margin-left: 8px;" data-lang="ar">عرض القمر الصناعي</label>
                  <label for="satellite-view" style="display: inline; margin-left: 8px; display: none;" data-lang="en">Satellite View</label>
                </div>
              </div>
              
              <div class="setting-item">
                <div class="setting-title" data-lang="ar">إعدادات المسار</div>
                <div class="setting-title" data-lang="en" style="display:none">Route Settings</div>
                <div style="margin-top: 8px;">
                  <input type="checkbox" id="avoid-tolls" checked>
                  <label for="avoid-tolls" style="display: inline; margin-left: 8px;" data-lang="ar">تجنب الطرق المدفوعة</label>
                  <label for="avoid-tolls" style="display: inline; margin-left: 8px; display: none;" data-lang="en">Avoid Tolls</label>
                </div>
                <div style="margin-top: 8px;">
                  <input type="checkbox" id="avoid-highways">
                  <label for="avoid-highways" style="display: inline; margin-left: 8px;" data-lang="ar">تجنب الطرق السريعة</label>
                  <label for="avoid-highways" style="display: inline; margin-left: 8px; display: none;" data-lang="en">Avoid Highways</label>
                </div>
              </div>
            </div>
            
            <div class="setting-item" style="margin-top: 12px;">
              <div class="setting-title" data-lang="ar">إعدادات الإشعارات</div>
              <div class="setting-title" data-lang="en" style="display:none">Notification Settings</div>
              <div style="margin-top: 8px;">
                <input type="checkbox" id="sound-alerts" checked>
                <label for="sound-alerts" style="display: inline; margin-left: 8px;" data-lang="ar">تنبيهات صوتية</label>
                <label for="sound-alerts" style="display: inline; margin-left: 8px; display: none;" data-lang="en">Sound Alerts</label>
              </div>
              <div style="margin-top: 8px;">
                <input type="checkbox" id="push-notifications">
                <label for="push-notifications" style="display: inline; margin-left: 8px;" data-lang="ar">إشعارات فورية</label>
                <label for="push-notifications" style="display: inline; margin-left: 8px; display: none;" data-lang="en">Push Notifications</label>
              </div>
            </div>
            
            <div style="margin-top: 16px;">
              <button class="btn btn-secondary">
                <i class="fas fa-save"></i> 
                <span data-lang="ar">حفظ الإعدادات</span>
                <span data-lang="en" style="display:none">Save Settings</span>
              </button>
            </div>
          </div>

          <div class="tab-content" id="monitoring-tab" style="display: none;">
            <h2 class="panel-title" style="color:var(--accent); margin-bottom: 16px;">
              <i class="fas fa-heartbeat"></i> 
              <span data-lang="ar">مراقبة النظام</span>
              <span data-lang="en" style="display:none">System Monitoring</span>
            </h2>
            
            <div class="traffic-indicators">
              <div class="traffic-indicator">
                <div data-lang="ar">كثافة المرور</div>
                <div data-lang="en" style="display:none">Traffic Density</div>
                <div class="indicator-value" id="traffic-density">72%</div>
                <div class="progress">
                  <div class="progress-bar" style="width: 72%"></div>
                </div>
              </div>
              <div class="traffic-indicator">
                <div data-lang="ar">وقت الاستجابة</div>
                <div data-lang="en" style="display:none">Response Time</div>
                <div class="indicator-value" id="response-time">4.2s</div>
                <div class="progress">
                  <div class="progress-bar" style="width: 84%"></div>
                </div>
              </div>
            </div>
            
            <div class="setting-item" style="margin-top: 16px;">
              <div class="setting-title" data-lang="ar">حالة الاتصال</div>
              <div class="setting-title" data-lang="en" style="display:none">Connection Status</div>
              <div style="margin-top: 8px;">
                <div style="display: flex; justify-content: space-between;">
                  <span data-lang="ar">GPS:</span>
                  <span data-lang="en" style="display:none">GPS:</span>
                  <span style="color: #27ae60;"><i class="fas fa-check-circle"></i> متصل</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 6px;">
                  <span data-lang="ar">إشارات المرور:</span>
                  <span data-lang="en" style="display:none">Traffic Signals:</span>
                  <span style="color: #27ae60;"><i class="fas fa-check-circle"></i> متصل</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 6px;">
                  <span data-lang="ar">خوادم النظام:</span>
                  <span data-lang="en" style="display:none">System Servers:</span>
                  <span style="color: #27ae60;"><i class="fas fa-check-circle"></i> نشط</span>
                </div>
              </div>
            </div>
            
            <div class="emergency-panel" style="margin-top: 16px;">
              <div class="emergency-title">
                <i class="fas fa-exclamation-triangle"></i>
                <span data-lang="ar">التحكم في حالات الطوارئ</span>
                <span data-lang="en" style="display:none">Emergency Control</span>
              </div>
              <button class="btn" style="background: #dc3545;">
                <i class="fas fa-broadcast-tower"></i>
                <span data-lang="ar">تفعيل وضع الطوارئ</span>
                <span data-lang="en" style="display:none">Activate Emergency Mode</span>
              </button>
            </div>
          </div>

          <footer style="margin-top:20px;color:rgba(255,255,255,0.65)">
            <div style="font-size:14px">نظام مسارات الإسعاف المتقدم © 2023 - الإصدار 2.1.4</div>
          </footer>
        </aside>

        <section class="map-panel">
          <div id="map"></div>

          <div class="status-bar">
            <div class="status-item">
              <i class="fas fa-ambulance" style="color: var(--accent);"></i> 
              <div id="ambulance-id">الإسعاف #124</div>
            </div>
            <div class="status-item">
              <i class="fas fa-map-pin" style="color: #27ae60;"></i> 
              <div id="current-location">جارٍ تحديد الموقع...</div>
            </div>
            <div class="status-item">
              <i class="fas fa-satellite-dish" style="color: var(--accent);"></i> 
              <div id="connect-status">متصل بـ GPS & إشارات المرور</div>
            </div>
            <div class="status-item">
              <i class="fas fa-shield-alt" style="color: #27ae60;"></i> 
              <div data-lang="ar">النظام نشط</div>
              <div data-lang="en" style="display:none">System Active</div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- About modal -->
  <div class="modal" id="aboutModal">
    <div class="modal-card">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px">
        <h3 data-lang="ar">عن النظام - الإسعاف المتقدم</h3>
        <h3 data-lang="en" style="display:none">About System - Advanced Ambulance</h3>
        <button class="close-btn" id="closeAbout">
          <span data-lang="ar">إغلاق</span>
          <span data-lang="en" style="display:none">Close</span>
        </button>
      </div>
      <div class="modal-grid">
        <div>
          <p data-lang="ar">نظام متكامل لإدارة مسارات سيارات الإسعاف مع دعم كامل لتخطيط المسارات الذكية، التحكم في إشارات المرور، وإنشاء الممرات الخضراء في الوقت الفعلي.</p>
          <p data-lang="en" style="display:none">A complete system for managing ambulance routes with full support for intelligent route planning, traffic signal control, and real-time green corridor creation.</p>
          
          <h4 data-lang="ar" style="margin-top: 16px;">المميزات الرئيسية</h4>
          <h4 data-lang="en" style="margin-top: 16px; display:none">Key Features</h4>
          <ul>
            <li data-lang="ar">تخطيط المسارات الذكي بناءً على حركة المرور في الوقت الفعلي</li>
            <li data-lang="en" style="display:none">Intelligent route planning based on real-time traffic</li>
            <li data-lang="ar">التكامل مع إشارات المرور الذكية لإنشاء الممرات الخضراء</li>
            <li data-lang="en" style="display:none">Integration with smart traffic signals for green corridors</li>
            <li data-lang="ar">مراقبة حالة النظام والاتصالات بشكل مستمر</li>
            <li data-lang="en" style="display:none">Continuous monitoring of system status and communications</li>
            <li data-lang="ar">واجهة مستخدم ثنائية اللغة (العربية والإنجليزية)</li>
            <li data-lang="en" style="display:none">Bilingual user interface (Arabic and English)</li>
          </ul>
          
          <h4 data-lang="ar" style="margin-top: 16px;">كيفية الاستخدام</h4>
          <h4 data-lang="en" style="margin-top: 16px; display:none">How to Use</h4>
          <ol>
            <li data-lang="ar">أدخل عنوان الوجهة في حقل البحث</li>
            <li data-lang="en" style="display:none">Enter the destination address in the search field</li>
            <li data-lang="ar">اختر تفضيل المسار المناسب (أسرع، أقصر، تجنب الازدحام، إلخ)</li>
            <li data-lang="en" style="display:none">Select the appropriate route preference (fastest, shortest, avoid traffic, etc.)</li>
            <li data-lang="ar">انقر على "احسب المسار" لرؤية المسارات المقترحة</li>
            <li data-lang="en" style="display:none">Click "Calculate Route" to see suggested routes</li>
            <li data-lang="ar">استخدم أزرار التحكم لتفعيل الممر الأخضر أو إخلاء الطريق</li>
            <li data-lang="en" style="display:none">Use control buttons to activate green corridor or clear the road</li>
          </ol>
        </div>
        <div style="background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); padding:16px; border-radius:8px; border: 1px solid rgba(255,255,255,0.05);">
          <h4 style="color: var(--accent); margin-bottom: 12px;">معلومات الاتصال</h4>
          <p><strong>مصطفى شوقي</strong></p>
          <p><i class="fas fa-phone"></i> +20 01004941449</p>
          <p><i class="fas fa-envelope"></i> moustafa@example.com</p>
          <p style="margin-top: 16px;"><strong data-lang="ar">الإصدار:</strong><strong data-lang="en" style="display:none">Version:</strong> 2.1.4</p>
          <p><strong data-lang="ar">آخر تحديث:</strong><strong data-lang="en" style="display:none">Last Update:</strong> 15 نوفمبر 2023</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Google Maps JS with your API key -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQaFBiwwxgNcrqmKcb12fBBvH8HqErRNY&libraries=places&language=ar&region=EG"></script>

  <script>
    // User data storage
    let userData = {
      driverName: '',
      ambulanceNumber: '',
      language: 'ar'
    };

    // BILINGUAL SUPPORT (simple): elements with data-lang="ar" or data-lang="en"
    let currentLang = 'ar';
    const setLang = (lang)=>{
      currentLang = lang;
      userData.language = lang;
      
      // Update page direction
      document.body.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
      
      // Update all text elements
      document.querySelectorAll('[data-lang]').forEach(el=>{
        if(el.getAttribute('data-lang')===lang) el.style.display = '';
        else el.style.display = 'none';
      });
      
      // Update Google Maps language if available
      if (window.google && window.google.maps) {
        // In a real implementation, you would reinitialize the map with the new language
        console.log('Language changed to: ' + lang);
      }
    };

    // Login functionality
    document.getElementById('loginBtn').addEventListener('click', function() {
      const driverName = document.getElementById('driverName').value || document.getElementById('driverNameEn').value;
      const ambulanceNumber = document.getElementById('ambulanceNumber').value || document.getElementById('ambulanceNumberEn').value;
      
      if (!driverName || !ambulanceNumber) {
        alert(currentLang === 'ar' ? 'يرجى إدخال جميع البيانات المطلوبة' : 'Please enter all required data');
        return;
      }
      
      // Save user data
      userData.driverName = driverName;
      userData.ambulanceNumber = ambulanceNumber;
      
      // Update UI with user data
      document.getElementById('driverDisplay').textContent = `السائق: ${driverName}`;
      document.getElementById('ambulanceDisplay').textContent = ` | رقم السيارة: ${ambulanceNumber}`;
      document.getElementById('driverDisplayEn').textContent = `Driver: ${driverName}`;
      document.getElementById('ambulanceDisplayEn').textContent = ` | Ambulance: ${ambulanceNumber}`;
      document.getElementById('userName').textContent = driverName;
      document.getElementById('userNameEn').textContent = driverName;
      document.getElementById('userAvatar').textContent = driverName.charAt(0);
      document.getElementById('ambulance-id').textContent = `الإسعاف #${ambulanceNumber}`;
      
      // Hide login screen and show app
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('appContainer').style.display = 'block';
      
      // Initialize the app
      initApp();
    });

    // Language toggle in main app
    document.getElementById('langToggle').addEventListener('click', ()=>{
      setLang(currentLang==='ar'?'en':'ar');
    });

    // Tab functionality
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active class from all tabs
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        // Add active class to clicked tab
        tab.classList.add('active');
        
        // Hide all tab contents
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.display = 'none';
        });
        
        // Show the selected tab content
        const tabId = tab.getAttribute('data-tab') + '-tab';
        document.getElementById(tabId).style.display = 'block';
      });
    });

    // About modal
    const aboutModal = document.getElementById('aboutModal');
    document.getElementById('aboutBtn').addEventListener('click', ()=> aboutModal.classList.add('show'));
    document.getElementById('closeAbout').addEventListener('click', ()=> aboutModal.classList.remove('show'));

    // Map initialization and routing (placeholder logic that works once you add API key)
    let map, userMarker, directionsService; 
    let routeRenderers = [];

    function initApp(){
      if(typeof google === 'undefined' || !google.maps){
        // show friendly error on the map container
        const mapEl = document.getElementById('map');
        mapEl.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:white;padding:20px;text-align:center;flex-direction:column;gap:12px;"><i class="fas fa-exclamation-triangle" style="font-size:48px;color:#f39c12;"></i><div>تعذر تحميل خرائط جوجل - يرجى التأكد من إضافة مفتاح API صحيح</div><div style="font-size:14px;margin-top:8px;">Replace YOUR_GOOGLE_MAPS_API_KEY with a valid key</div></div>';
        return;
      }

      map = new google.maps.Map(document.getElementById('map'), { 
        center:{lat:30.0444,lng:31.2357}, 
        zoom:13, 
        styles: [
          {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
          {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
          {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
          {
            featureType: 'administrative.locality',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'poi',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'poi.park',
            elementType: 'geometry',
            stylers: [{color: '#263c3f'}]
          },
          {
            featureType: 'poi.park',
            elementType: 'labels.text.fill',
            stylers: [{color: '#6b9a76'}]
          },
          {
            featureType: 'road',
            elementType: 'geometry',
            stylers: [{color: '#38414e'}]
          },
          {
            featureType: 'road',
            elementType: 'geometry.stroke',
            stylers: [{color: '#212a37'}]
          },
          {
            featureType: 'road',
            elementType: 'labels.text.fill',
            stylers: [{color: '#9ca5b3'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry',
            stylers: [{color: '#746855'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry.stroke',
            stylers: [{color: '#1f2835'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'labels.text.fill',
            stylers: [{color: '#f3d19c'}]
          },
          {
            featureType: 'transit',
            elementType: 'geometry',
            stylers: [{color: '#2f3948'}]
          },
          {
            featureType: 'transit.station',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'water',
            elementType: 'geometry',
            stylers: [{color: '#17263c'}]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.fill',
            stylers: [{color: '#515c6d'}]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.stroke',
            stylers: [{color: '#17263c'}]
          }
        ]
      });
      
      directionsService = new google.maps.DirectionsService();

      // Traffic layer
      const trafficLayer = new google.maps.TrafficLayer(); 
      trafficLayer.setMap(map);

      // Autocomplete place
      const destInput = currentLang === 'ar' ? document.getElementById('destination') : document.getElementById('destinationEn');
      const autocomplete = new google.maps.places.Autocomplete(destInput, { 
        fields:['place_id','geometry','name','formatted_address'],
        componentRestrictions: {country: 'eg'}
      });

      // try geolocation
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
          const lat = pos.coords.latitude, lng = pos.coords.longitude;
          setUserLocation(lat,lng);
        }, err=>{
          document.getElementById('current-location').textContent = currentLang === 'ar' ? 'تعذّر الحصول على الموقع' : 'Failed to get location';
          // Set a default location (Cairo)
          setUserLocation(30.0444, 31.2357);
        });
      } else {
        // Set a default location (Cairo)
        setUserLocation(30.0444, 31.2357);
      }

      document.getElementById('calculate-route').addEventListener('click', onCalculateRoute);
      
      // Signal control buttons
      document.getElementById('green-corridor').addEventListener('click', () => {
        alert(currentLang === 'ar' ? 'تم تفعيل نظام الممر الأخضر. سيتم إغلاق الطرق اللازمة لمرور سيارات الإسعاف.' : 'Green corridor activated. Necessary roads will be closed for ambulance passage.');
      });
      
      document.getElementById('clear-right').addEventListener('click', () => {
        alert(currentLang === 'ar' ? 'تم إرسال إشارة لإخلاء الجانب الأيمن من الطريق لمرور سيارات الإسعاف.' : 'Signal sent to clear the right side of the road for ambulance passage.');
      });
    }

    function setUserLocation(lat,lng){
      const pos = {lat, lng};
      map.setCenter(pos); 
      map.setZoom(14);
      
      if(userMarker) userMarker.setMap(null);
      
      userMarker = new google.maps.Marker({ 
        position: pos, 
        map,
        icon: {
          url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
            <svg width="40" height="40" xmlns="http://www.w3.org/2000/svg">
              <circle cx="20" cy="20" r="15" fill="#0d6efd" stroke="#ffffff" stroke-width="3"/>
              <text x="20" y="26" text-anchor="middle" fill="white" font-family="Arial" font-size="14">A</text>
            </svg>
          `),
          scaledSize: new google.maps.Size(40, 40),
          anchor: new google.maps.Point(20, 20)
        },
        title: currentLang === 'ar' ? 'موقعك الحالي' : 'Your current location'
      });
      
      document.getElementById('current-location').textContent = currentLang === 'ar' 
        ? `خط العرض: ${lat.toFixed(4)}, خط الطول: ${lng.toFixed(4)}`
        : `Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`;
      
      // small simulated updates
      setInterval(()=>{
        if (userMarker) {
          const currentPos = userMarker.getPosition();
          const jitterLat = currentPos.lat() + (Math.random()*0.0006 - 0.0003);
          const jitterLng = currentPos.lng() + (Math.random()*0.0006 - 0.0003);
          userMarker.setPosition(new google.maps.LatLng(jitterLat,jitterLng));
          document.getElementById('current-location').textContent = currentLang === 'ar' 
            ? `خط العرض: ${jitterLat.toFixed(4)}, خط الطول: ${jitterLng.toFixed(4)}`
            : `Lat: ${jitterLat.toFixed(4)}, Lng: ${jitterLng.toFixed(4)}`;
        }
      }, 5000);
    }

    function onCalculateRoute(){
      const dest = currentLang === 'ar' 
        ? document.getElementById('destination').value.trim()
        : document.getElementById('destinationEn').value.trim();
        
      if(!dest){ 
        alert(currentLang==='ar'?'يرجى إدخال وجهة':'Please enter a destination'); 
        return; 
      }
      
      if(!userMarker){ 
        alert(currentLang==='ar'?'الموقع الحالي غير متاح':'Current location not available'); 
        return; 
      }

      // Show loading state
      const routesList = document.getElementById('routes-list');
      routesList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);"><i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 8px;"></i><div data-lang="ar">جاري البحث عن المسارات...</div><div data-lang="en" style="display:none">Searching for routes...</div></div>';

      // clear old routes
      routeRenderers.forEach(r=>r.setMap(null)); 
      routeRenderers=[];

      const request = { 
        origin: userMarker.getPosition(), 
        destination: dest, 
        travelMode: 'DRIVING', 
        provideRouteAlternatives: true, 
        drivingOptions: { 
          departureTime: new Date() 
        } 
      };
      
      directionsService.route(request, (result, status)=>{
        if(status==='OK') {
          handleDirectionsResult(result);
        } else {
          alert((currentLang==='ar'? 'فشل في الحصول على المسارات: ' : 'Directions error: ')+status);
          routesList.innerHTML = '<div style="text-align: center; padding: 20px; color: #e74c3c;"><i class="fas fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 8px;"></i><div data-lang="ar">فشل في العثور على مسارات. يرجى التحقق من الوجهة والمحاولة مرة أخرى.</div><div data-lang="en" style="display:none">Failed to find routes. Please check the destination and try again.</div></div>';
        }
      });
    }

    function handleDirectionsResult(result){
      const routes = result.routes; 
      const simplified = routes.map((r,idx)=>{ 
        const leg = r.legs[0]; 
        return { 
          idx, 
          distanceText: leg.distance.text, 
          durationText: leg.duration.text, 
          durationValue: leg.duration.value, 
          durationInTrafficText: (leg.duration_in_traffic ? leg.duration_in_traffic.text : leg.duration.text), 
          durationInTrafficValue: (leg.duration_in_traffic ? leg.duration_in_traffic.value : leg.duration.value), 
          summary: r.summary || (currentLang === 'ar' ? `المسار ${idx+1}` : `Route ${idx+1}`), 
          route: r 
        }; 
      });

      // pick best by preference
      const pref = document.getElementById('route-preference').value;
      let bestIdx = 0;
      
      if(pref==='fastest') {
        bestIdx = simplified.reduce((b,c)=>c.durationInTrafficValue < b.durationInTrafficValue? c:b, simplified[0]).idx;
      } else if(pref==='shortest') {
        bestIdx = simplified.reduce((b,c)=>parseFloat(c.distanceText) < parseFloat(b.distanceText)? c:b, simplified[0]).idx;
      } else {
        // Default to "best" which considers multiple factors
        bestIdx = simplified.reduce((b,c)=> {
          const bScore = calculateRouteScore(b);
          const cScore = calculateRouteScore(c);
          return cScore > bScore ? c : b;
        }, simplified[0]).idx;
      }

      const list = document.getElementById('routes-list'); 
      list.innerHTML = '';
      
      simplified.forEach(s=>{
        const isBest = s.idx === bestIdx;
        const el = document.createElement('div'); 
        el.className = 'route-option' + (isBest ? ' active' : ''); 
        el.innerHTML = `
          <div style="font-weight:700; display: flex; align-items: center; gap: 8px;">
            ${isBest ? '<i class="fas fa-crown" style="color: gold;"></i>' : ''}
            ${s.summary}
          </div>
          <div style="display:flex;justify-content:space-between;margin-top:8px">
            <span>${s.distanceText}</span>
            <span class="muted">${s.durationInTrafficText}</span>
          </div>
        `;
        
        el.addEventListener('click', ()=>{
          document.querySelectorAll('.route-option').forEach(x=>x.classList.remove('active'));
          el.classList.add('active');
          renderSingleRoute(s.route);
          updateRouteInfoFromLeg(s.route.legs[0]);
        });
        
        list.appendChild(el);
        renderSingleRoute(s.route, s.idx===bestIdx?0.9:0.4, s.idx===bestIdx?'#0d6efd':'#86b7ff');
      });
      
      const best = simplified.find(x=>x.idx===bestIdx); 
      updateRouteInfoFromLeg(best.route.legs[0]); 
      
      const bounds = new google.maps.LatLngBounds(); 
      best.route.overview_path.forEach(p=>bounds.extend(p)); 
      map.fitBounds(bounds);
    }
    
    function calculateRouteScore(route) {
      // Calculate a score based on multiple factors
      let score = 100;
      
      // Prefer shorter routes (distance)
      const distance = parseFloat(route.distanceText);
      score -= distance * 0.5;
      
      // Prefer faster routes (time)
      const time = route.durationInTrafficValue / 60; // Convert to minutes
      score -= time * 0.3;
      
      // Prefer routes with less traffic impact
      const trafficImpact = route.durationInTrafficValue - route.durationValue;
      score -= trafficImpact * 0.1;
      
      return score;
    }

    function renderSingleRoute(route, opacity=0.8, strokeColor='#0d6efd'){
      const poly = new google.maps.Polyline({ 
        path: route.overview_path, 
        strokeColor, 
        strokeOpacity: opacity, 
        strokeWeight: 6 
      }); 
      poly.setMap(map); 
      routeRenderers.push(poly); 
      return poly;
    }

    function updateRouteInfoFromLeg(leg){ 
      document.getElementById('distance').textContent = leg.distance.text; 
      document.getElementById('duration').textContent = (leg.duration_in_traffic?leg.duration_in_traffic.text:leg.duration.text); 
      
      const duration = (leg.duration_in_traffic?leg.duration_in_traffic.value:leg.duration.value); 
      const normal = leg.duration.value; 
      const diff = duration - normal; 
      const percent = Math.round((diff/normal)*100); 
      
      const t = document.getElementById('traffic-indicator'); 
      const txt = document.getElementById('traffic-text'); 
      const txtEn = document.getElementById('traffic-text-en');
      
      if(percent <= 10){ 
        t.style.background='#27ae60'; 
        document.getElementById('traffic').textContent = currentLang === 'ar' ? 'منخفضة' : 'Low';
        txt.textContent = currentLang === 'ar' ? 'حركة مرور منخفضة - المسار سلس' : 'Low traffic - Smooth route';
        txtEn.textContent = 'Low traffic - Smooth route';
      } else if(percent <= 40){ 
        t.style.background='#f39c12'; 
        document.getElementById('traffic').textContent = currentLang === 'ar' ? 'متوسطة' : 'Medium';
        txt.textContent = currentLang === 'ar' ? 'حركة مرور متوسطة - يوجد بعض التأخير' : 'Medium traffic - Some delays';
        txtEn.textContent = 'Medium traffic - Some delays';
      } else { 
        t.style.background='#e74c3c'; 
        document.getElementById('traffic').textContent = currentLang === 'ar' ? 'مرتفعة' : 'High';
        txt.textContent = currentLang === 'ar' ? 'حركة مرور مرتفعة - ازدحام شديد' : 'High traffic - Heavy congestion';
        txtEn.textContent = 'High traffic - Heavy congestion';
      } 
    }

    // Set initial language
    setLang('ar');

    // Instructions to user (console)
    console.info('Ambulance UI loaded with API key');
  </script>
</body>
</html>
